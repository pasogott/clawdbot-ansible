---
# macOS-specific Docker installation (Docker Desktop)

- name: Check if Docker Desktop is installed (macOS)
  ansible.builtin.stat:
    path: /Applications/Docker.app
  register: docker_desktop

- name: Install Docker Desktop via Homebrew Cask (macOS)
  community.general.homebrew_cask:
    name: docker
    state: present
  environment:
    PATH: "/opt/homebrew/bin:{{ ansible_env.PATH }}"
  when: not docker_desktop.stat.exists

- name: Wait for Docker Desktop to be available (macOS)
  ansible.builtin.wait_for:
    path: /var/run/docker.sock
    timeout: 120
  when: not docker_desktop.stat.exists

- name: Display Docker Desktop installation note (macOS)
  ansible.builtin.debug:
    msg: |
      ℹ️  Docker Desktop installed on macOS.
      Please ensure Docker Desktop is running and has been configured.
      You may need to start it manually from Applications.
  when: not docker_desktop.stat.exists

- name: Verify Docker is accessible
  ansible.builtin.command: docker --version
  register: docker_version
  changed_when: false
  failed_when: false

- name: Display Docker version
  ansible.builtin.debug:
    msg: "Docker installed: {{ docker_version.stdout }}"
  when: docker_version.rc == 0

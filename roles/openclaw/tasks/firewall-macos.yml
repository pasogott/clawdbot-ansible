---
# macOS-specific firewall configuration (pf)

- name: Display macOS firewall information
  ansible.builtin.debug:
    msg: |
      ℹ️  macOS uses built-in Application Firewall and pf.
      Docker Desktop on macOS handles its own network isolation.
      Consider configuring the Application Firewall via System Preferences.

- name: Check macOS firewall status
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
  register: macos_firewall_status
  changed_when: false
  become: true

- name: Display firewall status
  ansible.builtin.debug:
    msg: "macOS Firewall Status: {{ macos_firewall_status.stdout }}"

- name: Enable macOS Application Firewall (if disabled)
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
  when: "'disabled' in macos_firewall_status.stdout.lower()"
  become: true
  changed_when: true

- name: Allow Tailscale through firewall
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --add /Applications/Tailscale.app
  failed_when: false
  become: true
  changed_when: false
